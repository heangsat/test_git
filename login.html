<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Authentication Script -->
    <script>
        // Authentication Manager
        class AuthManager {
            static DEFAULT_USERS = [
                {
                    id: 'admin-001',
                    username: 'admin',
                    email: 'admin@school.edu',
                    password: 'admin123',
                    role: 'administrator',
                    name: 'Admin User',
                    permissions: ['read', 'write', 'delete', 'manage_users']
                },
                {
                    id: 'teacher-001',
                    username: 'teacher',
                    email: 'teacher@school.edu',
                    password: 'teacher123',
                    role: 'teacher',
                    name: 'John Smith',
                    permissions: ['read', 'write']
                },
                {
                    id: 'staff-001',
                    username: 'staff',
                    email: 'staff@school.edu',
                    password: 'staff123',
                    role: 'staff',
                    name: 'Jane Doe',
                    permissions: ['read']
                }
            ];

            static initializeUsers() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify(this.DEFAULT_USERS));
                }
            }

            static generateSessionId() {
                return 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            }

            static login(email, password, rememberMe = false) {
                this.initializeUsers();

                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.email === email && u.password === password);

                if (user) {
                    const expiresAt = rememberMe ?
                        new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString() : // 30 days
                        new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString(); // 8 hours

                    const sessionData = {
                        id: user.id,
                        email: user.email,
                        name: user.name,
                        role: user.role,
                        permissions: user.permissions,
                        loggedInAt: new Date().toISOString(),
                        sessionId: this.generateSessionId(),
                        expiresAt: expiresAt
                    };

                    // Store session
                    localStorage.setItem('currentSession', JSON.stringify(sessionData));

                    // Handle remember me
                    if (rememberMe) {
                        localStorage.setItem('rememberMe', 'true');
                        localStorage.setItem('rememberedUser', JSON.stringify({email: user.email}));
                    } else {
                        localStorage.removeItem('rememberMe');
                        localStorage.removeItem('rememberedUser');
                    }

                    return { success: true, user: user };
                }

                return { success: false, error: 'Invalid email or password' };
            }

            static logout() {
                localStorage.removeItem('currentSession');
                localStorage.removeItem('rememberMe');
                localStorage.removeItem('rememberedUser');
                window.location.href = 'login.html';
            }

            static isLoggedIn() {
                const session = localStorage.getItem('currentSession');
                if (!session) return false;

                const sessionData = JSON.parse(session);
                const now = new Date();
                const expiresAt = new Date(sessionData.expiresAt);

                if (now > expiresAt) {
                    // Session expired
                    this.logout();
                    return false;
                }

                return true;
            }

            static getCurrentUser() {
                if (!this.isLoggedIn()) return null;

                const session = JSON.parse(localStorage.getItem('currentSession'));
                return session;
            }

            static checkSessionOnPageLoad() {
                // Redirect to login if not authenticated
                const publicPages = ['login.html'];
                const currentPage = window.location.pathname.split('/').pop() || 'index.html';

                if (!publicPages.includes(currentPage) && !this.isLoggedIn()) {
                    window.location.href = 'login.html';
                }
            }
        }

        // Login Form Handler
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.querySelector('form');
            const loginBtn = document.getElementById('loginBtn');
            const rememberMeCheckbox = document.getElementById('rememberMe');
            const errorMessage = document.getElementById('errorMessage');
            const emailInput = document.querySelector('input[type="email"]');
            const passwordInput = document.querySelector('input[type="password"]');

            // Check if already logged in
            if (AuthManager.isLoggedIn()) {
                AuthManager.checkSessionOnPageLoad();
                return; // Already logged in, could redirect
            }

            // Load remembered user
            const remembered = localStorage.getItem('rememberedUser');
            if (remembered) {
                try {
                    const userData = JSON.parse(remembered);
                    emailInput.value = userData.email;
                    rememberMeCheckbox.checked = true;
                } catch (e) {
                    console.log('Error loading remembered user:', e);
                }
            }

            // Handle form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const email = emailInput.value.trim();
                const password = passwordInput.value.trim();
                const rememberMe = rememberMeCheckbox.checked;

                // Basic validation
                if (!email || !password) {
                    showError('Please enter both email and password.');
                    return;
                }

                // Attempt login
                const result = AuthManager.login(email, password, rememberMe);

                if (result.success) {
                    // Success - redirect to dashboard
                    loginBtn.disabled = true;
                    loginBtn.textContent = 'Logging in...';

                    // Store current user name in localStorage for dashboard
                    localStorage.setItem('currentUser', result.user.name);

                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                } else {
                    // Show error
                    showError(result.error || 'Login failed. Please try again.');
                }
            });

            // Handle social login (placeholders)
            document.querySelectorAll('.btn-social').forEach(btn => {
                btn.addEventListener('click', function() {
                    const provider = this.textContent.trim().toLowerCase();
                    showError(`${provider.charAt(0).toUpperCase() + provider.slice(1)} login is not implemented yet.`);
                });
            });

            // Handle forgot password
            document.querySelector('.forgot-password').addEventListener('click', function(e) {
                e.preventDefault();
                showError('Password reset functionality will be available soon. Contact your administrator.');
            });

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
        });

        // Show default login credentials in console for testing
        console.log('Available login credentials:');
        console.log('Admin: admin@school.edu / admin123');
        console.log('Teacher: teacher@school.edu / teacher123');
        console.log('Staff: staff@school.edu / staff123');
    </script>
</body>
</html>
