<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base href="/test_git/">
  <title>Emma Wilson - Student Profile | EduManage</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3f37c9;
      --gradient: linear-gradient(135deg, #4361ee, #3f37c9);
      --success: #4cc9f0;
      --warning: #f72585;
      --shadow: 0 10px 30px rgba(67, 97, 238, 0.15);
      --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.12);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7ff 0%, #e0e7ff 100%);
      min-height: 100vh;
    }

    .sidebar {
      width: 270px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      border-right: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: var(--shadow-lg);
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: 1000;
    }

    .logo h4 {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    .nav-link {
      border-radius: 12px;
      margin: 6px 12px;
      padding: 12px 16px !important;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-link:hover {
      background: rgba(67, 97, 238, 0.1);
      transform: translateX(8px);
    }

    .nav-link.active {
      background: var(--gradient) !important;
      box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
      color: white !important;
    }

    .main-content {
      margin-left: 270px;
      padding: 2.5rem;
    }

    .profile-header {
      background: var(--gradient);
      color: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .profile-photo {
      width: 140px;
      height: 140px;
      border-radius: 20px;
      object-fit: cover;
      border: 6px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .status-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .info-card {
      border: none;
      border-radius: 18px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(67, 97, 238, 0.18);
    }

    .info-card .card-header {
      background: rgba(67, 97, 238, 0.08);
      border: none;
      font-weight: 600;
      color: var(--primary-dark);
      padding: 1.2rem 1.5rem;
    }

    .btn-action {
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-weight: 500;
    }

    .tab-content {
      background: white;
      border-radius: 0 0 18px 18px;
      padding: 1.5rem;
      border-top: 1px solid #eee;
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar vh-100 d-flex flex-column">
    <div class="p-4">
      <div class="logo">
        <h4 class="mb-3"><i class="bi bi-mortarboard-fill"></i> StuManage</h4>
      </div>
    </div>
    <nav class="nav nav-pills flex-column px-3 flex-grow-1">
      <a class="nav-link text-muted" href="index.html"><i class="bi bi-grid-fill me-2"></i> Dashboard</a>
      <a class="nav-link active text-muted" href="student-detail.html"><i class="bi bi-people me-2"></i> Students Detail</a>
      <a class="nav-link text-muted" href="student-enroll.html"><i class="bi bi-person-plus-fill me-2"></i> Enroll
        Student</a>
      <a class="nav-link text-muted" href="student-list.html"><i class="bi bi-person-badge me-2"></i> List Student</a>
      <a class="nav-link text-muted" href="course.html"><i class="bi bi-book me-2"></i> Courses</a>
      <a class="nav-link text-muted" href="attendence.html"><i class="bi bi-calendar-check me-2"></i> Attendance</a>
      <a class="nav-link text-muted" href="#"><i class="bi bi-graph-up me-2"></i> Reports</a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">

    <!-- Profile Header -->
    <div class="profile-header mb-5">
      <div class="row align-items-center">
        <div class="col-auto">
          <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop&crop=face"
            alt="Emma Wilson" class="profile-photo">
        </div>
        <div class="col">
          <h2 class="mb-1 fw-bold">Emma Wilson</h2>
          <p class="mb-2 opacity-90"><strong>Student ID:</strong> STD-2024-001</p>
          <p class="mb-0">
            <i class="bi bi-calendar-check"></i> Enrolled: 12 May 2024 •
            <i class="bi bi-mortarboard-fill"></i> Grade 10 - Science A •
            <i class="bi bi-person"></i> Dr. Linda Johnson
          </p>
        </div>
        <div class="col-auto text-end">
          <div class="status-badge bg-success shadow">Active</div>
          <div class="mt-4">
            <button class="btn btn-light btn-action me-2"><i class="bi bi-pencil"></i> Edit</button>
            <button class="btn btn-outline-light btn-action"><i class="bi bi-printer"></i> Print ID</button>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">

      <!-- Personal Information -->
      <div class="col-lg-8">
        <div class="info-card">
          <div class="card-header">
            <i class="bi bi-person-circle text-primary"></i> Personal Information
          </div>
          <div class="card-body p-4">
            <div class="row g-4">
              <div class="col-md-6">
                <strong>Date of Birth:</strong><br>15 March 2009 (Age 16)
              </div>
              <div class="col-md-6">
                <strong>Gender:</strong><br>Female
              </div>
              <div class="col-md-6">
                <strong>Nationality:</strong><br>Canadian
              </div>
              <div class="col-md-6">
                <strong>Ethnicity:</strong><br>Caucasian
              </div>
              <div class="col-12">
                <strong>Language Preference:</strong><br>English (Native), French (Fluent)
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Academic Summary -->
      <div class="col-lg-4">
        <div class="info-card h-100">
          <div class="card-header">
            <i class="bi bi-book-fill text-primary"></i> Academic Status
          </div>
          <div class="card-body p-4">
            <ul class="list-unstyled mb-0">
              <li class="mb-3"><strong>Grade Level:</strong> <span class="text-primary float-end">Grade 10</span></li>
              <li class="mb-3"><strong>Program:</strong> <span class="float-end">Science Stream</span></li>
              <li class="mb-3"><strong>Expected Graduation:</strong> <span class="text-success float-end">June
                  2027</span></li>
              <li class="mb-3"><strong>Attendance Rate:</strong> <span class="text-success float-end">98.5%</span></li>
              <li><strong>Financial Aid:</strong> <span class="badge bg-warning text-dark float-end">Partial
                  Scholarship</span></li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div class="col-12">
        <div class="info-card">
          <div class="card-header">
            <i class="bi bi-telephone-fill text-primary"></i> Contact & Address
          </div>
          <div class="card-body p-4">
            <div class="row">
              <div class="col-md-6">
                <p><strong>Email:</strong> emma.wilson@student.edumanage.edu.kh</p>
                <p><strong>Personal Email:</strong> emma.wilson2009@gmail.com</p>
                <p><strong>Phone:</strong> +855 96 888 7774</p>
              </div>
              <div class="col-md-6">
                <strong>Address:</strong><br>
                House 12A, Street 371, Sangkat Boeung Tum Pun<br>
                Khan Mean Chey, Phnom Penh, Cambodia 120409
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Emergency Contact -->
      <div class="col-md-6">
        <div class="info-card">
          <div class="card-header">
            <i class="bi bi-exclamation-triangle-fill text-danger"></i> Emergency Contact
          </div>
          <div class="card-body p-4">
            <p class="mb-1"><strong>Sarah Wilson</strong> (Mother)</p>
            <p class="mb-1">+855 17 555 901</p>
            <p class="mb-0">sarah.wilson@company.com</p>
          </div>
        </div>
      </div>

      <!-- Parent / Guardian -->
      <div class="col-md-6">
        <div class="info-card">
          <div class="card-header">
            <i class="bi bi-person-heart text-primary"></i> Parent / Guardian
          </div>
          <div class="card-body p-4">
            <p class="mb-1"><strong>Mark Wilson</strong> (Father)</p>
            <p class="mb-1">+855 12 999 123</p>
            <p class="mb-0">mark.wilson@globaltech.com</p>
          </div>
        </div>
      </div>

      <!-- Accessibility & Notes -->
      <div class="col-12">
        <div class="info-card">
          <div class="card-header">
            <i class="bi bi-universal-access text-primary"></i> Accessibility & Additional Notes
          </div>
          <div class="card-body p-4">
            <p><strong>Disability / Accommodations:</strong> Mild dyslexia — extra time on exams approved</p>
            <p><strong>Notes:</strong> Participates in debate club and volleyball team. Allergic to peanuts (EpiPen in
              nurse office).</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Data Management Functions
    class DataManager {
      static get(key, defaultValue = []) {
        try {
          const data = localStorage.getItem(key);
          return data ? JSON.parse(data) : defaultValue;
        } catch (e) {
          console.error('Error reading from localStorage:', e);
          return defaultValue;
        }
      }

      static calculateAttendanceRate(studentId) {
        const attendance = this.get('attendance', []);
        const studentAttendance = attendance.filter(a => a.studentId === studentId);
        if (studentAttendance.length === 0) return 0;
        const present = studentAttendance.filter(a => a.status === 'Present').length;
        return Math.round((present / studentAttendance.length) * 100);
      }

      static getCurrentMonthAttendance(studentId) {
        const attendance = this.get('attendance', []);
        const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
        return attendance.filter(a =>
          a.studentId === studentId &&
          a.date.startsWith(currentMonth)
        );
      }
    }

    // Load student details
    document.addEventListener('DOMContentLoaded', function() {
      // Authentication Check
      const currentSession = localStorage.getItem('currentSession');
      if (!currentSession) {
        window.location.href = 'login.html';
        return;
      }

      try {
        const session = JSON.parse(currentSession);
        const now = new Date();
        const expiresAt = new Date(session.expiresAt);

        if (now > expiresAt) {
          localStorage.removeItem('currentSession');
          localStorage.removeItem('rememberMe');
          localStorage.removeItem('rememberedUser');
          localStorage.removeItem('currentUser');
          window.location.href = 'login.html';
          return;
        }
      } catch (e) {
        localStorage.removeItem('currentSession');
        localStorage.removeItem('rememberMe');
        localStorage.removeItem('rememberedUser');
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
        return;
      }

      const studentId = sessionStorage.getItem('selectedStudentId');

      if (!studentId) {
        alert('No student selected. Redirecting to student list.');
        window.location.href = 'student-list.html';
        return;
      }

      const students = DataManager.get('students', []);
      const student = students.find(s => s.studentId === studentId);

      if (!student) {
        alert('Student not found. Redirecting to student list.');
        window.location.href = 'student-list.html';
        return;
      }

      loadStudentDetails(student);
    });

    function loadStudentDetails(student) {
      // Update profile header
      document.querySelector('.profile-header img').src = student.photo ||
        `https://api.dicebear.com/7.x/avataaars/svg?seed=${student.firstName}_${student.lastName}`;

      document.querySelector('.profile-header h2').textContent =
        `${student.firstName} ${student.middleName || ''} ${student.lastName}`;

      document.querySelector('.profile-header .col p strong').textContent =
        `Student ID: ${student.studentId}`;

      // Update enrollment info
      const enrollmentInfo = document.querySelector('.profile-header .col p:nth-child(3)');
      const attendanceRate = DataManager.calculateAttendanceRate(student.studentId);
      enrollmentInfo.innerHTML = `
        <i class="bi bi-calendar-check"></i> Enrolled: ${new Date(student.enrollmentDate).toLocaleDateString()} •
        <i class="bi bi-mortarboard-fill"></i> ${student.gradeLevel} - ${student.program || 'General'} •
        <i class="bi bi-person"></i> Dr. Linda Johnson •
        <i class="bi bi-check-circle"></i> ${attendanceRate}% Attendance
      `;

      // Update status badge
      const statusBadge = document.querySelector('.status-badge');
      const statusClass = student.status === 'Active' ? 'bg-success' :
                         student.status === 'Inactive' ? 'bg-danger' : 'bg-warning';
      statusBadge.className = `status-badge shadow ${statusClass}`;
      statusBadge.textContent = student.status;

      // Personal Information
      const personalInfo = document.querySelector('.info-card .card-body .row');
      const dob = new Date(student.dob);
      const age = new Date().getFullYear() - dob.getFullYear();
      personalInfo.innerHTML = `
        <div class="col-md-6">
          <strong>Date of Birth:</strong><br>${dob.toLocaleDateString()} (Age ${age})
        </div>
        <div class="col-md-6">
          <strong>Gender:</strong><br>${student.gender || 'Not specified'}
        </div>
        <div class="col-md-6">
          <strong>Nationality:</strong><br>${student.nationality || 'Cambodian'}
        </div>
        <div class="col-md-6">
          <strong>Ethnicity:</strong><br>${student.ethnicity || 'Not specified'}
        </div>
        <div class="col-12">
          <strong>Language Preference:</strong><br>${student.languagePreference || 'ភាសាខ្មែរ'}
        </div>
      `;

      // Academic Status
      const academicStatus = document.querySelector('.info-card.h-100 .card-body ul');
      const programMap = {
        'Science': 'Science Stream',
        'Literary': 'Literature Stream',
        'Arts': 'Arts Program',
        'General': 'General Studies'
      };
      const program = programMap[student.program] || student.program || 'General Studies';
      const graduationYear = new Date(student.dob ? student.dob : '2007-01-01').getFullYear() + 18;

      academicStatus.innerHTML = `
        <li class="mb-3"><strong>Grade Level:</strong> <span class="text-primary float-end">${student.gradeLevel}</span></li>
        <li class="mb-3"><strong>Program:</strong> <span class="float-end">${program}</span></li>
        <li class="mb-3"><strong>Expected Graduation:</strong> <span class="text-success float-end">June ${graduationYear}</span></li>
        <li class="mb-3"><strong>Attendance Rate:</strong> <span class="text-success float-end">${attendanceRate}%</span></li>
        <li><strong>Financial Aid:</strong> <span class="badge bg-${student.scholarship === 'Full Scholarship' ? 'success' : student.scholarship === 'None' ? 'secondary' : 'warning'} text-${student.scholarship === 'Full Scholarship' ? 'white' : 'dark'} float-end">${student.scholarship || 'None'}</span></li>
      `;

      // Contact Information
      const contactInfo = document.querySelector('.info-card:nth-child(4) .card-body .row');
      contactInfo.innerHTML = `
        <div class="col-md-6">
          <p><strong>School Email:</strong> ${student.email}</p>
          <p><strong>Personal Email:</strong> ${student.personalEmail || 'Not provided'}</p>
          <p><strong>Phone:</strong> ${student.phone}</p>
        </div>
        <div class="col-md-6">
          <strong>Address:</strong><br>
          ${student.address || 'Address not provided'}
        </div>
      `;

      // Emergency Contact
      const emergencyCard = document.querySelector('.col-md-6 .info-card .card-body');
      if (student.emergencyContact) {
        emergencyCard.innerHTML = `
          <p class="mb-1"><strong>${student.emergencyContact.name}</strong> (${student.emergencyContact.relationship})</p>
          <p class="mb-1">${student.emergencyContact.phone}</p>
          <p class="mb-0">${student.emergencyContact.email || 'No email provided'}</p>
        `;
      } else {
        emergencyCard.innerHTML = '<p class="text-muted">No emergency contact information provided</p>';
      }

      // Parent/Guardian
      const parentCard = document.querySelector('.col-md-6:last-of-type .info-card .card-body');
      if (student.parentGuardianName) {
        parentCard.innerHTML = `
          <p class="mb-1"><strong>${student.parentGuardianName}</strong></p>
          <p class="mb-0">(Contact information not provided in system)</p>
        `;
      } else {
        parentCard.innerHTML = '<p class="text-muted">No parent/guardian information provided</p>';
      }

      // Accessibility & Notes
      const notesCard = document.querySelector('.col-12:last-of-type .card-body');
      const hasSpecialNeeds = student.accessibilityNeeds || student.previousSchool;
      if (hasSpecialNeeds || student.status !== 'Active') {
        notesCard.innerHTML = `
          ${student.accessibilityNeeds ? `<p><strong>Disability / Accommodations:</strong> ${student.accessibilityNeeds}</p>` : ''}
          ${student.previousSchool ? `<p><strong>Previous School:</strong> ${student.previousSchool}</p>` : ''}
          ${student.status !== 'Active' ? `<p><strong>Status Notes:</strong> Student is currently ${student.status.toLowerCase()}</p>` : ''}
          ${!hasSpecialNeeds && student.status === 'Active' ? '<p class="text-muted">No additional notes available</p>' : ''}
        `;
      } else {
        notesCard.innerHTML = '<p class="text-muted">No additional notes available</p>';
      }

      // Add attendance section if there's attendance data
      addAttendanceSection(student);
    }

    function addAttendanceSection(student) {
      const attendance = DataManager.get('attendance', []);
      const studentAttendance = attendance.filter(a => a.studentId === student.studentId);

      if (studentAttendance.length > 0) {
        const mainContent = document.querySelector('.main-content');
        const attendanceSection = document.createElement('div');
        attendanceSection.className = 'mt-5';

        const recentAttendance = studentAttendance
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .slice(0, 10);

        attendanceSection.innerHTML = `
          <div class="info-card">
            <div class="card-header">
              <i class="bi bi-calendar-check-fill text-primary"></i> Recent Attendance (Last 10 days)
            </div>
            <div class="card-body p-4">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Status</th>
                      <th>Time</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${recentAttendance.map(att => `
                      <tr>
                        <td>${new Date(att.date).toLocaleDateString()}</td>
                        <td>
                          <span class="badge ${
                            att.status === 'Present' ? 'bg-success' :
                            att.status === 'Absent' ? 'bg-danger' :
                            att.status === 'Late' ? 'bg-warning' : 'bg-info'
                          }">${att.status}</span>
                        </td>
                        <td>${att.time || '-'}</td>
                        <td>${att.notes || '-'}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;

        mainContent.appendChild(attendanceSection);
      }
    }

    // Edit functionality
    document.querySelector('.btn-action').addEventListener('click', function() {
      alert('Edit functionality would redirect to enrollment form with pre-filled data.');
      // Could redirect to enrollment form with student data
    });

    // Print ID functionality
    document.querySelectorAll('.btn-action')[1].addEventListener('click', function() {
      window.print();
    });
  </script>
</body>

</html>
