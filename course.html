<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <base href="/test_git/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses - Student Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-purple: #6C5CE7;
            --secondary-blue: #6C8BFF;
            --secondary-pink: #F97A9A;
            --bg-light: #F5F7FA;
            --text-dark: #333;
            --text-muted: #777;
            --gradient: linear-gradient(135deg, #4361ee, #3f37c9);

        }

        body {
            background-color: var(--bg-light);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 260px;
            background: white;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar .logo {
            padding: 24px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-purple);
        }

        .sidebar .nav-link {
            border-radius: 12px;
            margin: 6px 12px;
            padding: 12px 16px !important;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666; 
        }

        .sidebar .nav-link:hover {
            background: rgba(67, 97, 238, 0.1);
            transform: translateX(8px);
            color: var(--primary-dark);
        }

        .sidebar .nav-link.active {
            background: var(--gradient) !important;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
            color: white !important;

            transform: translateX(4px);
        }

        .help-widget {
            position: absolute;
            bottom: 24px;
            left: 16px;
            right: 16px;
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-blue));
            border-radius: 12px;
            padding: 16px;
            color: white;
        }

        .help-badge {
            background: rgba(255, 255, 255, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 8px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 24px;
        }

        /* Page Header */
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .page-title {
            color: var(--text-dark);
            font-weight: bold;
            margin-bottom: 8px;
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
            margin: 0;
        }

        /* Search and Filter Bar */
        .filter-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .search-input {
            border-radius: 10px;
            padding: 10px 16px;
            border: 1px solid #e0e0e0;
        }

        .filter-select {
            border-radius: 10px;
            padding: 10px 16px;
            border: 1px solid #e0e0e0;
        }

        .btn-add-course {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-blue));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 24px;
            font-weight: 600;
        }

        .btn-add-course:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
            color: white;
        }

        /* Course Cards */
        .course-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            height: 100%;
        }

        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .course-header {
            padding: 20px;
            color: white;
            position: relative;
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .course-header.blue {
            background: linear-gradient(135deg, #6C8BFF, #4EABFF);
        }

        .course-header.purple {
            background: linear-gradient(135deg, #6C5CE7, #9B8FF7);
        }

        .course-header.pink {
            background: linear-gradient(135deg, #F97A9A, #FF9FB8);
        }

        .course-header.green {
            background: linear-gradient(135deg, #00D97E, #39E196);
        }

        .course-header.orange {
            background: linear-gradient(135deg, #FFA500, #FFB84D);
        }

        .course-header.teal {
            background: linear-gradient(135deg, #20C997, #5FE3BD);
        }

        .course-code {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 500;
        }

        .course-title {
            font-size: 20px;
            font-weight: bold;
            margin: 8px 0 0 0;
        }

        .course-body {
            padding: 20px;
        }

        .course-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .meta-item i {
            color: var(--primary-purple);
        }

        .course-description {
            color: var(--text-muted);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .course-teacher {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .teacher-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-purple);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .teacher-info small {
            color: var(--text-muted);
            font-size: 12px;
        }

        .course-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-view {
            background: var(--primary-purple);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-view:hover {
            background: #5046c7;
            transform: translateY(-2px);
        }

        .badge-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-active {
            background: #D4EDDA;
            color: #155724;
        }

        .badge-inactive {
            background: #F8D7DA;
            color: #721C24;
        }

        .badge-upcoming {
            background: #FFF3CD;
            color: #856404;
        }

        /* Stats Cards */
        .stats-row {
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.blue {
            background: rgba(108, 139, 255, 0.1);
            color: var(--secondary-blue);
        }

        .stat-icon.purple {
            background: rgba(108, 92, 231, 0.1);
            color: var(--primary-purple);
        }

        .stat-icon.green {
            background: rgba(0, 217, 126, 0.1);
            color: #00D97E;
        }

        .stat-icon.orange {
            background: rgba(255, 165, 0, 0.1);
            color: #FFA500;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Action Buttons */
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            background: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            transition: all 0.3s;
            margin-left: 8px;
        }

        .action-btn:hover {
            border-color: var(--primary-purple);
            color: var(--primary-purple);
            background: var(--bg-light);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="bi bi-mortarboard-fill"></i> StuManage
        </div>
        <nav class="nav flex-column">
            <a class="nav-link" href="index.html"><i class="bi bi-grid-fill me-2"></i> Dashboard</a>
            <a class="nav-link text-muted" href="student-list.html"><i class="bi bi-person-badge me-2"></i> List
                Student</a>
            <a class="nav-link active text-muted" href="course.html"><i class="bi bi-book me-2"></i> Courses</a>
            <a class="nav-link" href="attendence.html"><i class="bi bi-calendar-check me-2"></i> Attendance</a>
            <a class="nav-link" href="#"><i class="bi bi-graph-up me-2"></i>Report!</a>
        </nav>

        <div class="help-widget">
            <div class="help-badge">
                <i class="bi bi-headset"></i> 24/7
            </div>
            <div class="mb-2"><strong>Need Support?</strong></div>
            <p class="small mb-2">Have questions about the system? Contact our support team.</p>
            <button class="btn btn-light btn-sm w-100">Get Help</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="page-title">Courses Management</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Courses</li>
                        </ol>
                    </nav>
                </div>
                <button class="btn btn-outline-primary me-2" onclick="window.location.href='student-enroll.html'">
                    <i class="bi bi-person-plus me-2"></i> Enroll Student
                </button>
                <button class="btn btn-outline-info me-2" onclick="window.location.href='student-detail.html'">
                    <i class="bi bi-eye me-2"></i> View Details
                </button>
                <button class="btn btn-add-course">
                    <i class="bi bi-plus-circle me-2"></i> Add New Course
                </button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="row stats-row g-3">
            <div class="col-md-3">
                <div class="stat-card">
                    <div>
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">Total Courses</div>
                    </div>
                    <div class="stat-icon blue">
                        <i class="bi bi-book-fill"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>
                        <div class="stat-number" id="activeCourses">0</div>
                        <div class="stat-label">Active Courses</div>
                    </div>
                    <div class="stat-icon green">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>
                        <div class="stat-number" id="totalEnrollments">0</div>
                        <div class="stat-label">Total Enrollments</div>
                    </div>
                    <div class="stat-icon purple">
                        <i class="bi bi-people-fill"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>
                        <div class="stat-number" id="totalTeachers">0</div>
                        <div class="stat-label">Instructors</div>
                    </div>
                    <div class="stat-icon orange">
                        <i class="bi bi-person-badge-fill"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="text" class="form-control search-input border-start-0"
                            placeholder="Search courses...">
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select filter-select">
                        <option selected>All Status</option>
                        <option>Active</option>
                        <option>Inactive</option>
                        <option>Upcoming</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select filter-select">
                        <option selected>All Grades</option>
                        <option>Grade 9</option>
                        <option>Grade 10</option>
                        <option>Grade 11</option>
                        <option>Grade 12</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select filter-select">
                        <option selected>All Subjects</option>
                        <option>Mathematics</option>
                        <option>Science</option>
                        <option>English</option>
                        <option>History</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100">
                        <i class="bi bi-funnel me-2"></i> Filter
                    </button>
                </div>
            </div>
        </div>

        <!-- Courses Grid -->
        <div class="row g-4" id="coursesGrid">
            <!-- Courses will be loaded dynamically -->
            <div class="col-12 text-center">
                <div class="text-muted">
                    <i class="bi bi-book-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                    <p class="mt-3">No courses found. Add your first course to get started.</p>
                </div>
            </div>
        </div>

        <!-- Course Modal -->
        <div class="modal fade" id="courseModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="courseModalTitle">Add New Course</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="courseForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Course Code</label>
                                    <input type="text" class="form-control" id="courseCode" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Course Title</label>
                                    <input type="text" class="form-control" id="courseTitle" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Subject</label>
                                    <select class="form-select" id="courseSubject" required>
                                        <option>Mathematics</option>
                                        <option>Science</option>
                                        <option>Biology</option>
                                        <option>Chemistry</option>
                                        <option>Physics</option>
                                        <option>English</option>
                                        <option>History</option>
                                        <option>Geography</option>
                                        <option>Art</option>
                                        <option>Music</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Grade Level</label>
                                    <select class="form-select" id="courseGrade" required>
                                        <option>Grade 9</option>
                                        <option>Grade 10</option>
                                        <option>Grade 11</option>
                                        <option>Grade 12</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Credits</label>
                                    <input type="number" class="form-control" id="courseCredits" value="1" min="1">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Duration (Hours)</label>
                                    <input type="number" class="form-control" id="courseHours" value="40" min="1">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Instructor</label>
                                    <select class="form-select" id="courseTeacher" required>
                                        <option value="">Select Teacher</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Semester</label>
                                    <select class="form-select" id="courseSemester">
                                        <option>Fall</option>
                                        <option>Spring</option>
                                        <option>Summer</option>
                                        <option>Year Round</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Schedule</label>
                                    <select class="form-select" id="courseSchedule">
                                        <option>Monday, Wednesday</option>
                                        <option>Tuesday, Thursday</option>
                                        <option>Monday, Wednesday, Friday</option>
                                        <option>Daily</option>
                                        <option>Flexible</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="courseStatus">
                                        <option>Active</option>
                                        <option>Upcoming</option>
                                        <option>Inactive</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Course Description</label>
                                    <textarea class="form-control" id="courseDescription" rows="3" placeholder="Enter course description..."></textarea>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Prerequisites (Optional)</label>
                                    <textarea class="form-control" id="coursePrerequisites" rows="2" placeholder="List any prerequisite courses or requirements..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveCourseBtn">Save Course</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Modal -->
        <div class="modal fade" id="teacherModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Teacher</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="teacherForm">
                            <div class="mb-3">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" id="teacherFirstName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="teacherLastName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="teacherEmail" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="teacherPhone">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Subject Specialization</label>
                                <select class="form-select" id="teacherSubject">
                                    <option>Mathematics</option>
                                    <option>Science</option>
                                    <option>Biology</option>
                                    <option>Chemistry</option>
                                    <option>Physics</option>
                                    <option>English</option>
                                    <option>History</option>
                                    <option>Geography</option>
                                    <option>Art</option>
                                    <option>Music</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Experience (Years)</label>
                                <input type="number" class="form-control" id="teacherExperience" min="0" value="5">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveTeacherBtn">Save Teacher</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mt-4">
            <div class="text-muted">Showing 1-6 of 42 courses</div>
            <nav>
                <ul class="pagination mb-0">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data Management Functions
      class DataManager {
        static get(key, defaultValue = []) {
          try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
          } catch (e) {
            console.error('Error reading from localStorage:', e);
            return defaultValue;
          }
        }

        static set(key, value) {
          try {
            localStorage.setItem(key, JSON.stringify(value));
          } catch (e) {
            console.error('Error writing to localStorage:', e);
          }
        }

        static generateId(prefix = 'CRSE') {
          return prefix + '-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        static update(key, id, updatedItem) {
          const data = this.get(key);
          const index = data.findIndex(item => item.id === id);
          if (index !== -1) {
            data[index] = { ...data[index], ...updatedItem };
            this.set(key, data);
            return true;
          }
          return false;
        }

        static delete(key, id) {
          const data = this.get(key);
          const filtered = data.filter(item => item.id !== id);
          this.set(key, filtered);
          return filtered.length !== data.length;
        }

        static find(key, id) {
          const data = this.get(key);
          return data.find(item => item.id === id);
        }
      }

      // Global variables
      let allCourses = [];
      let allTeachers = [];
      let allStudents = [];
      let currentFilter = {
        search: '',
        status: 'All Status',
        grade: 'All Grades',
        subject: 'All Subjects'
      };
      let isEditing = false;
      let editingCourseId = null;

      // Authentication Check
      class AuthenticationCheck {
        static init() {
          const currentSession = localStorage.getItem('currentSession');
          if (!currentSession) {
            window.location.href = 'login.html';
            return;
          }

          try {
            const session = JSON.parse(currentSession);
            const now = new Date();
            const expiresAt = new Date(session.expiresAt);

            if (now > expiresAt) {
              this.logout();
              return;
            }
          } catch (e) {
            this.logout();
          }
        }

        static logout() {
          localStorage.removeItem('currentSession');
          localStorage.removeItem('rememberMe');
          localStorage.removeItem('rememberedUser');
          localStorage.removeItem('currentUser');
          window.location.href = 'login.html';
        }
      }

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        AuthenticationCheck.init();

        // Check user permissions and adjust UI
        const currentUser = AuthManager.getCurrentUser();
        const isAdmin = currentUser && currentUser.role === 'administrator';
        const canEdit = isAdmin;

        // Hide admin-only features for non-admin users
        if (!canEdit) {
          // Hide add course button
          document.querySelector('.btn-add-course').style.display = 'none';

          // Hide edit/delete buttons in course cards
          document.addEventListener('click', function(e) {
            if (e.target.closest('.action-btn')) {
              e.preventDefault();
              alert('You do not have permission to modify courses. Contact an administrator.');
              return false;
            }
          });

          // Hide teacher creation features
          if (typeof saveTeacher === 'function') {
            window.saveTeacher = function() {
              alert('You do not have permission to add teachers. Contact an administrator.');
            };
          }

          // Show read-only message
          setTimeout(() => {
            alert('You have read-only access to course information. Contact an administrator to make changes.');
          }, 1000);
        }

        loadData();
        setupEventListeners();
        updateStatistics();
        renderCourses();
      });

      function loadData() {
        allCourses = DataManager.get('courses', []);
        allTeachers = DataManager.get('teachers', []);
        allStudents = DataManager.get('students', []);
      }

      function setupEventListeners() {
        // Add course button
        document.querySelector('.btn-add-course').addEventListener('click', function() {
          openCourseModal(false);
        });

        // Course form
        document.getElementById('saveCourseBtn').addEventListener('click', saveCourse);

        // Teacher form
        document.getElementById('saveTeacherBtn').addEventListener('click', saveTeacher);

        // Search
        document.querySelector('.search-input').addEventListener('input', function() {
          currentFilter.search = this.value.toLowerCase();
          renderCourses();
        });

        // Filters
        document.querySelectorAll('.filter-select').forEach((select, index) => {
          select.addEventListener('change', function() {
            const filterTypes = ['status', 'grade', 'subject'];
            currentFilter[filterTypes[index]] = this.value;
            renderCourses();
          });
        });

        // Filter button
        document.querySelector('.filter-bar .btn-outline-secondary').addEventListener('click', function() {
          renderCourses();
        });
      }

      function renderCourses() {
        const coursesGrid = document.getElementById('coursesGrid');

        let filteredCourses = allCourses.filter(course => {
          // Search filter
          if (currentFilter.search) {
            const searchMatch = course.title.toLowerCase().includes(currentFilter.search) ||
                               course.code.toLowerCase().includes(currentFilter.search) ||
                               course.description.toLowerCase().includes(currentFilter.search) ||
                               course.subject.toLowerCase().includes(currentFilter.search);
            if (!searchMatch) return false;
          }

          // Status filter
          if (currentFilter.status !== 'All Status' && course.status !== currentFilter.status) return false;

          // Grade filter
          if (currentFilter.grade !== 'All Grades' && course.gradeLevel !== currentFilter.grade) return false;

          // Subject filter
          if (currentFilter.subject !== 'All Subjects' && course.subject !== currentFilter.subject) return false;

          return true;
        });

        if (filteredCourses.length === 0) {
          coursesGrid.innerHTML = `
            <div class="col-12 text-center">
              <div class="text-muted">
                <i class="bi bi-search" style="font-size: 3rem; opacity: 0.3;"></i>
                <p class="mt-3">No courses match your filters. Try adjusting your search criteria.</p>
              </div>
            </div>
          `;
          return;
        }

        const courseCards = filteredCourses.map(course => createCourseCard(course)).join('');
        coursesGrid.innerHTML = courseCards;

        // Update pagination info
        updatePagination(filteredCourses.length);
      }

      function createCourseCard(course) {
        const teacher = allTeachers.find(t => t.id === course.teacherId);
        const enrollmentCount = course.students ? course.students.length : 0;
        const teacherName = teacher ? `${teacher.firstName} ${teacher.lastName}` : 'Not Assigned';
        const teacherInitials = teacher ? (teacher.firstName.charAt(0) + teacher.lastName.charAt(0)).toUpperCase() : 'NA';

        const headerColors = ['blue', 'purple', 'pink', 'green', 'orange', 'teal'];
        const headerColor = headerColors[Math.abs(course.code.split('').reduce((a, c) => a + c.charCodeAt(0), 0)) % headerColors.length];

        const badgeClass = course.status === 'Active' ? 'badge-active' :
                          course.status === 'Inactive' ? 'badge-inactive' : 'badge-upcoming';

        return `
          <div class="col-md-6 col-lg-4">
            <div class="course-card" data-course-id="${course.id}">
              <div class="course-header ${headerColor}">
                <div>
                  <div class="course-code">${course.code}</div>
                  <h5 class="course-title">${course.title}</h5>
                </div>
                <div class="text-end">
                  <button class="action-btn" onclick="editCourse('${course.id}')" title="Edit Course">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="action-btn" onclick="deleteCourse('${course.id}')" title="Delete Course">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              <div class="course-body">
                <div class="course-meta">
                  <div class="meta-item">
                    <i class="bi bi-people-fill"></i>
                    <span>${enrollmentCount} Students</span>
                  </div>
                  <div class="meta-item">
                    <i class="bi bi-clock-fill"></i>
                    <span>${course.duration} Hours</span>
                  </div>
                </div>
                <p class="course-description">
                  ${course.description || 'No description provided.'}
                </p>
                <div class="course-teacher">
                  <div class="teacher-avatar">${teacherInitials}</div>
                  <div class="teacher-info">
                    <small>Instructor</small>
                    <div><strong>${teacherName}</strong></div>
                  </div>
                </div>
                <div class="course-footer">
                  <span class="badge-status ${badgeClass}">${course.status}</span>
                  <button class="btn-view" onclick="viewCourse('${course.id}')">View Details</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function updateStatistics() {
        const totalCourses = allCourses.length;
        const activeCourses = allCourses.filter(c => c.status === 'Active').length;
        const totalEnrollments = allCourses.reduce((sum, c) => sum + (c.students ? c.students.length : 0), 0);

        document.getElementById('totalCourses').textContent = totalCourses.toString();
        document.getElementById('activeCourses').textContent = activeCourses.toString();
        document.getElementById('totalEnrollments').textContent = totalEnrollments.toString();
        document.getElementById('totalTeachers').textContent = allTeachers.length.toString();
      }

      function updatePagination(count) {
        const paginationInfo = document.querySelector('.d-flex .text-muted');
        if (paginationInfo) {
          paginationInfo.textContent = `Showing ${count} of ${allCourses.length} courses`;
        }
      }

      function openCourseModal(isEditing = false) {
        this.isEditing = isEditing;

        if (!isEditing) {
          // Load teachers into dropdown
          loadTeachersIntoDropdown();
          // Reset form
          resetCourseForm();
          document.getElementById('courseModalTitle').textContent = 'Add New Course';
        }

        const modal = new bootstrap.Modal(document.getElementById('courseModal'));
        modal.show();
      }

      function resetCourseForm() {
        document.getElementById('courseForm').reset();
        document.getElementById('courseCode').value = generateCourseCode();
      }

      function generateCourseCode() {
        const year = new Date().getFullYear().toString().slice(2);
        const existingCodes = allCourses.map(c => c.code);
        let counter = 1;
        let code;
        do {
          code = `CRS${year}${counter.toString().padStart(3, '0')}`;
          counter++;
        } while (existingCodes.includes(code));
        return code;
      }

      function loadTeachersIntoDropdown() {
        const teacherSelect = document.getElementById('courseTeacher');
        teacherSelect.innerHTML = '<option value="">Select Teacher</option>';

        allTeachers.forEach(teacher => {
          const option = document.createElement('option');
          option.value = teacher.id;
          option.textContent = `${teacher.firstName} ${teacher.lastName} (${teacher.subject})`;
          teacherSelect.appendChild(option);
        });

        // Add option to create new teacher
        const addNewOption = document.createElement('option');
        addNewOption.value = 'new';
        addNewOption.textContent = '+ Add New Teacher';
        teacherSelect.appendChild(addNewOption);
      }

      function editCourse(courseId) {
        const course = DataManager.find('courses', courseId);
        if (!course) return;

        this.editingCourseId = courseId;
        loadTeachersIntoDropdown();

        // Populate form
        document.getElementById('courseCode').value = course.code;
        document.getElementById('courseTitle').value = course.title;
        document.getElementById('courseSubject').value = course.subject;
        document.getElementById('courseGrade').value = course.gradeLevel;
        document.getElementById('courseCredits').value = course.credits;
        document.getElementById('courseHours').value = course.duration;
        document.getElementById('courseTeacher').value = course.teacherId || '';
        document.getElementById('courseSemester').value = course.semester;
        document.getElementById('courseSchedule').value = course.schedule;
        document.getElementById('courseStatus').value = course.status;
        document.getElementById('courseDescription').value = course.description || '';
        document.getElementById('coursePrerequisites').value = course.prerequisites || '';

        document.getElementById('courseModalTitle').textContent = 'Edit Course';
        openCourseModal(true);
      }

      function saveCourse() {
        const teacherId = document.getElementById('courseTeacher').value;

        // Handle new teacher creation
        if (teacherId === 'new') {
          const teacherModal = new bootstrap.Modal(document.getElementById('teacherModal'));
          teacherModal.show();
          return;
        }

        // Validate form
        const formData = {
          code: document.getElementById('courseCode').value.trim(),
          title: document.getElementById('courseTitle').value.trim(),
          subject: document.getElementById('courseSubject').value,
          gradeLevel: document.getElementById('courseGrade').value,
          credits: parseInt(document.getElementById('courseCredits').value),
          duration: parseInt(document.getElementById('courseHours').value),
          teacherId: teacherId,
          semester: document.getElementById('courseSemester').value,
          schedule: document.getElementById('courseSchedule').value,
          status: document.getElementById('courseStatus').value,
          description: document.getElementById('courseDescription').value.trim(),
          prerequisites: document.getElementById('coursePrerequisites').value.trim(),
          students: []
        };

        // Validation
        if (!formData.code || !formData.title) {
          alert('Please fill in required fields (Code and Title)');
          return;
        }

        if (this.isEditing) {
          // Update existing course
          const updated = DataManager.update('courses', this.editingCourseId, formData);
          if (updated) {
            loadData();
            renderCourses();
            updateStatistics();
            bootstrap.Modal.getInstance(document.getElementById('courseModal')).hide();
            alert('Course updated successfully!');
          }
        } else {
          // Create new course
          formData.id = DataManager.generateId('CRSE');
          formData.createdAt = new Date().toISOString();

          allCourses.push(formData);
          DataManager.set('courses', allCourses);

          loadData();
          renderCourses();
          updateStatistics();
          bootstrap.Modal.getInstance(document.getElementById('courseModal')).hide();
          alert('Course created successfully!');
        }

        updateDashboardStats();
      }

      function deleteCourse(courseId) {
        if (!confirm('Are you sure you want to delete this course? This action cannot be undone and will remove all student enrollments.')) {
          return;
        }

        const deleted = DataManager.delete('courses', courseId);
        if (deleted) {
          loadData();
          renderCourses();
          updateStatistics();
          alert('Course deleted successfully!');
        }

        updateDashboardStats();
      }

      function viewCourse(courseId) {
        const course = DataManager.find('courses', courseId);
        if (!course) return;

        // Store course data for detail page
        sessionStorage.setItem('selectedCourse', JSON.stringify(course));

        // For now, show alert. In full implementation, navigate to course detail page
        alert(`Viewing course: ${course.title}\n\nEnrolled students: ${course.students ? course.students.length : 0}\n\nTeacher: ${allTeachers.find(t => t.id === course.teacherId)?.firstName} ${allTeachers.find(t => t.id === course.teacherId)?.lastName}`);
      }

      function saveTeacher() {
        const formData = {
          firstName: document.getElementById('teacherFirstName').value.trim(),
          lastName: document.getElementById('teacherLastName').value.trim(),
          email: document.getElementById('teacherEmail').value.trim(),
          phone: document.getElementById('teacherPhone').value.trim(),
          subject: document.getElementById('teacherSubject').value,
          experience: parseInt(document.getElementById('teacherExperience').value),
          status: 'Active'
        };

        // Validation
        if (!formData.firstName || !formData.lastName || !formData.email) {
          alert('Please fill in required fields (Name and Email)');
          return;
        }

        // Check if email already exists
        const emailExists = allTeachers.some(t => t.email === formData.email);
        if (emailExists) {
          alert('A teacher with this email already exists!');
          return;
        }

        // Create teacher
        formData.id = DataManager.generateId('TEACH');
        formData.createdAt = new Date().toISOString();

        allTeachers.push(formData);
        DataManager.set('teachers', allTeachers);

        // Close teacher modal and update course modal
        bootstrap.Modal.getInstance(document.getElementById('teacherModal')).hide();
        resetTeacherForm();

        // Reload teachers in dropdown
        loadTeachersIntoDropdown();
        document.getElementById('courseTeacher').value = formData.id;

        alert('Teacher added successfully! Continue creating the course.');
      }

      function resetTeacherForm() {
        document.getElementById('teacherForm').reset();
      }

      function updateDashboardStats() {
        try {
          localStorage.setItem('courses_updated', new Date().toISOString());
        } catch (e) {
          console.log('Could not update dashboard:', e);
        }
      }

      // Initialize demo data always (to ensure students are shown)
      initializeDemoData();

      function initializeDemoData() {
        // Create some demo teachers
        const demoTeachers = [
          {
            id: 'TEACH3Z2Q05XNK',
            firstName: 'Michael',
            lastName: 'Kumar',
            email: 'michael.kumar@school.edu',
            phone: '+1 234 567 8901',
            subject: 'Mathematics',
            experience: 8,
            status: 'Active',
            createdAt: new Date().toISOString()
          },
          {
            id: 'TEACH4A7R91ZMD',
            firstName: 'Dr. Linda',
            lastName: 'Johnson',
            email: 'linda.johnson@school.edu',
            phone: '+1 234 567 8902',
            subject: 'Biology',
            experience: 12,
            status: 'Active',
            createdAt: new Date().toISOString()
          },
          {
            id: 'TEACH8F4S67XRP',
            firstName: 'Sarah',
            lastName: 'Peterson',
            email: 'sarah.peterson@school.edu',
            phone: '+1 234 567 8903',
            subject: 'English',
            experience: 6,
            status: 'Active',
            createdAt: new Date().toISOString()
          }
        ];

        // Create some demo courses
        const demoCourses = [
          {
            id: 'CRSE3Z2Q05XNK',
            code: 'MATH-101',
            title: 'Advanced Mathematics',
            subject: 'Mathematics',
            gradeLevel: 'Grade 11',
            credits: 1,
            duration: 48,
            teacherId: 'TEACH3Z2Q05XNK',
            semester: 'Fall',
            schedule: 'Monday, Wednesday',
            status: 'Active',
            description: 'Comprehensive mathematics course covering algebra, calculus, and advanced problem-solving techniques for grade 11 students.',
            prerequisites: 'Mathematics 101',
            students: [],
            createdAt: new Date().toISOString()
          },
          {
            id: 'CRSE4A7R91ZMD',
            code: 'BIOL-201',
            title: 'Biology & Life Sciences',
            subject: 'Biology',
            gradeLevel: 'Grade 10',
            credits: 1,
            duration: 40,
            teacherId: 'TEACH4A7R91ZMD',
            semester: 'Spring',
            schedule: 'Tuesday, Thursday',
            status: 'Active',
            description: 'Explore the fascinating world of biology including cell structure, genetics, evolution, and ecosystems.',
            prerequisites: 'Basic Biology',
            students: [],
            createdAt: new Date().toISOString()
          },
          {
            id: 'CRSE8F4S67XRP',
            code: 'CHEM-102',
            title: 'Chemistry Fundamentals',
            subject: 'Chemistry',
            gradeLevel: 'Grade 10',
            credits: 1,
            duration: 44,
            teacherId: 'TEACH4A7R91ZMD',
            semester: 'Fall',
            schedule: 'Monday, Wednesday, Friday',
            status: 'Upcoming',
            description: 'Introduction to chemical principles including atomic structure, bonding, reactions, and laboratory techniques.',
            prerequisites: 'Basic Chemistry',
            students: [],
            createdAt: new Date().toISOString()
          }
        ];

        // Always set demo data for courses and teachers
        DataManager.set('teachers', demoTeachers);
        DataManager.set('courses', demoCourses);

        // Reload data
        loadData();
        updateStatistics();
      }

      // Make functions global
      window.editCourse = editCourse;
      window.deleteCourse = deleteCourse;
      window.viewCourse = viewCourse;
    </script>
</body>

</html>
